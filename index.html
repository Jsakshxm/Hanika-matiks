<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Matiks IQ Challenge</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --lime: #B1FA63;
            --purple: #B3A1FF;
            --dark: #1a1a2e;
            --darker: #0f0f1a;
        }

        html, body {
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--darker);
            color: white;
            height: 100vh;
            height: 100dvh;
        }

        #app {
            height: 100%;
        }

        .screen {
            display: none;
            height: 100vh;
            height: 100dvh;
            padding: 15px;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
        }

        .screen.active {
            display: flex;
        }

        .content {
            text-align: center;
            width: 100%;
            max-width: 360px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex: 1;
            gap: 12px;
        }

        /* Landing Screen */
        .logo {
            font-size: clamp(2.5rem, 12vw, 4rem);
            font-weight: 900;
            background: linear-gradient(135deg, var(--lime), var(--purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -2px;
        }

        .tagline {
            font-size: clamp(0.9rem, 3.5vw, 1.1rem);
            color: rgba(255,255,255,0.6);
            margin-bottom: 15px;
        }

        .game-preview {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .game-icon {
            font-size: clamp(1.5rem, 6vw, 2rem);
            padding: 12px;
            background: linear-gradient(145deg, var(--dark), #252542);
            border-radius: 16px;
            border: 2px solid rgba(255,255,255,0.1);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--lime), #9ae050);
            color: var(--darker);
            font-size: clamp(1rem, 4vw, 1.15rem);
            font-weight: 800;
            padding: 16px 45px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 6px 25px rgba(177, 250, 99, 0.35);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary:active {
            transform: scale(0.97);
        }

        .btn-secondary {
            background: transparent;
            color: white;
            font-size: 0.9rem;
            padding: 12px 30px;
            border: 2px solid rgba(255,255,255,0.25);
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
        }

        .info-text {
            color: rgba(255,255,255,0.45);
            font-size: 0.85rem;
        }

        /* Game Screens */
        .game-screen {
            padding: 12px 12px 15px 12px;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 360px;
            padding: 10px 15px;
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            flex-shrink: 0;
        }

        .game-title {
            font-size: clamp(0.95rem, 4vw, 1.1rem);
            font-weight: 700;
            color: var(--lime);
        }

        .timer {
            font-size: clamp(1.3rem, 5vw, 1.6rem);
            font-weight: 900;
            color: var(--purple);
            background: var(--dark);
            padding: 8px 16px;
            border-radius: 12px;
            min-width: 55px;
            text-align: center;
            border: 2px solid rgba(179, 161, 255, 0.3);
        }

        .timer.warning {
            color: #ff6b6b;
            border-color: #ff6b6b;
            animation: timerPulse 0.5s infinite;
        }

        @keyframes timerPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.08); }
        }

        .score {
            font-size: clamp(0.8rem, 3vw, 0.9rem);
            color: rgba(255,255,255,0.7);
            font-weight: 600;
        }

        .score span {
            color: var(--lime);
            font-weight: 800;
        }

        .game-container {
            width: 100%;
            max-width: 360px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex: 1;
            padding: 10px 0;
        }

        /* Pattern Match */
        .pattern-sequence {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(255,255,255,0.03);
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.08);
        }

        .pattern-item {
            width: clamp(55px, 16vw, 65px);
            height: clamp(55px, 16vw, 65px);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(1.3rem, 5vw, 1.6rem);
            font-weight: 800;
            border-radius: 14px;
            background: linear-gradient(145deg, var(--dark), #252542);
            border: 2px solid rgba(255,255,255,0.15);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            color: white;
        }

        .pattern-item.pattern-answer {
            background: linear-gradient(145deg, rgba(177, 250, 99, 0.15), rgba(177, 250, 99, 0.05));
            border: 2px dashed var(--lime);
            color: var(--lime);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.04); }
        }

        .pattern-item.correct-answer {
            background: linear-gradient(145deg, var(--lime), #9ae050);
            color: var(--darker);
            border: 2px solid var(--lime);
            animation: popIn 0.3s ease;
        }

        @keyframes popIn {
            0% { transform: scale(0.8); }
            50% { transform: scale(1.08); }
            100% { transform: scale(1); }
        }

        .pattern-instruction {
            font-size: clamp(0.9rem, 3.5vw, 1rem);
            color: rgba(255,255,255,0.6);
            margin-bottom: 15px;
            text-align: center;
        }

        .pattern-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            width: 100%;
            max-width: 280px;
        }

        .pattern-option {
            width: 100%;
            height: clamp(60px, 15vw, 70px);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(1.4rem, 5vw, 1.7rem);
            font-weight: 800;
            background: linear-gradient(145deg, var(--purple), #9a8ae6);
            color: var(--darker);
            border-radius: 14px;
            cursor: pointer;
            border: none;
            box-shadow: 0 4px 15px rgba(179, 161, 255, 0.3);
        }

        .pattern-option:active {
            transform: scale(0.95);
        }

        .pattern-option.correct {
            background: linear-gradient(145deg, var(--lime), #9ae050);
            box-shadow: 0 4px 20px rgba(177, 250, 99, 0.5);
        }

        .pattern-option.incorrect {
            background: linear-gradient(145deg, #ff6b6b, #e55a5a);
            animation: shake 0.4s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-6px); }
            75% { transform: translateX(6px); }
        }

        /* Mind Snap */
        .mindsnap-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            padding: 15px;
            background: rgba(255,255,255,0.03);
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.08);
        }

        .mindsnap-cell {
            width: clamp(50px, 14vw, 60px);
            height: clamp(50px, 14vw, 60px);
            background: linear-gradient(145deg, var(--dark), #252542);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid rgba(255,255,255,0.1);
        }

        .mindsnap-cell:active {
            transform: scale(0.95);
        }

        .mindsnap-cell.shown {
            background: linear-gradient(145deg, var(--lime), #9ae050);
            border-color: var(--lime);
            box-shadow: 0 4px 15px rgba(177, 250, 99, 0.4);
        }

        .mindsnap-cell.correct {
            background: linear-gradient(145deg, var(--lime), #9ae050);
            border-color: var(--lime);
        }

        .mindsnap-cell.incorrect {
            background: linear-gradient(145deg, #ff6b6b, #e55a5a);
            border-color: #ff6b6b;
        }

        .game-message {
            font-size: clamp(0.95rem, 3.5vw, 1.05rem);
            color: rgba(255,255,255,0.7);
            text-align: center;
            margin-top: 15px;
            padding: 12px 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
        }

        /* Math Game */
        .math-problem {
            text-align: center;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .math-question {
            font-size: clamp(2rem, 8vw, 2.5rem);
            font-weight: 900;
            margin-bottom: 20px;
            color: var(--lime);
            padding: 18px 25px;
            background: rgba(177, 250, 99, 0.08);
            border-radius: 16px;
            border: 2px solid rgba(177, 250, 99, 0.2);
            width: 100%;
            max-width: 280px;
        }

        .math-input {
            font-size: clamp(1.5rem, 6vw, 1.8rem);
            text-align: center;
            width: 100%;
            max-width: 180px;
            padding: 14px;
            border: 3px solid var(--purple);
            border-radius: 14px;
            background: var(--dark);
            color: white;
            margin-bottom: 15px;
        }

        .math-input:focus {
            outline: none;
            border-color: var(--lime);
        }

        .math-input.correct {
            border-color: var(--lime);
            background: rgba(177, 250, 99, 0.15);
        }

        .math-input.incorrect {
            border-color: #ff6b6b;
            background: rgba(255, 107, 107, 0.15);
        }

        .numpad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            width: 100%;
            max-width: 240px;
            padding: 12px;
            background: rgba(255,255,255,0.03);
            border-radius: 18px;
        }

        .numpad-btn {
            font-size: clamp(1.2rem, 5vw, 1.4rem);
            font-weight: 700;
            padding: 14px;
            border: none;
            border-radius: 12px;
            background: linear-gradient(145deg, var(--dark), #252542);
            color: white;
            cursor: pointer;
            border: 2px solid rgba(255,255,255,0.1);
        }

        .numpad-btn:active {
            background: linear-gradient(145deg, var(--purple), #9a8ae6);
            color: var(--darker);
        }

        .numpad-btn:last-child {
            grid-column: span 2;
            background: linear-gradient(145deg, #3a3a5c, #2a2a4c);
        }

        /* Results Screen */
        .results-screen .content {
            gap: 6px;
            justify-content: flex-start;
            padding-top: 10px;
        }

        .ranking-badge {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #1a1a2e;
            padding: 8px 20px;
            border-radius: 50px;
            font-weight: 800;
            font-size: clamp(0.8rem, 3vw, 0.9rem);
            margin-bottom: 5px;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
        }

        .iq-score {
            font-size: clamp(4rem, 18vw, 5.5rem);
            font-weight: 900;
            background: linear-gradient(135deg, var(--lime), var(--purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1;
        }

        .iq-label {
            font-size: 0.75rem;
            color: rgba(255,255,255,0.4);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 5px;
        }

        .genius-comparison {
            font-size: clamp(0.8rem, 3vw, 0.9rem);
            color: var(--lime);
            padding: 10px 15px;
            background: rgba(177, 250, 99, 0.1);
            border-radius: 12px;
            border: 1px solid rgba(177, 250, 99, 0.2);
            line-height: 1.4;
            width: 100%;
        }

        .genius-comparison .genius-names {
            color: white;
            font-weight: 700;
        }

        /* Share Card */
        .share-card {
            width: 100%;
            background: linear-gradient(145deg, #1f1f35, #15152a);
            border-radius: 16px;
            padding: 15px;
            border: 1px solid rgba(255,255,255,0.1);
            margin: 8px 0;
        }

        .share-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .share-card-logo {
            font-size: 1.2rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--lime), var(--purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .share-card-badge {
            font-size: 0.7rem;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #1a1a2e;
            padding: 4px 10px;
            border-radius: 20px;
            font-weight: 700;
        }

        .share-card-scores {
            display: flex;
            justify-content: space-around;
            gap: 8px;
        }

        .share-card-score-item {
            text-align: center;
            flex: 1;
            padding: 8px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
        }

        .share-card-score-value {
            font-size: 1.3rem;
            font-weight: 800;
            color: var(--lime);
        }

        .share-card-score-label {
            font-size: 0.65rem;
            color: rgba(255,255,255,0.5);
            text-transform: uppercase;
        }

        .share-card-iq {
            text-align: center;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .share-card-iq-value {
            font-size: 2rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--lime), var(--purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .share-card-iq-label {
            font-size: 0.7rem;
            color: rgba(255,255,255,0.5);
        }

        .cta-message {
            font-size: clamp(0.75rem, 2.8vw, 0.85rem);
            color: rgba(255,255,255,0.7);
            padding: 10px 15px;
            background: rgba(179, 161, 255, 0.1);
            border-radius: 12px;
            border: 1px dashed rgba(179, 161, 255, 0.3);
            line-height: 1.4;
            width: 100%;
        }

        .cta-message strong {
            color: var(--purple);
        }

        .btn-share {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            background: linear-gradient(145deg, #1a1a1a, #0a0a0a);
            color: white;
            font-size: clamp(0.95rem, 3.5vw, 1.05rem);
            font-weight: 700;
            padding: 14px 30px;
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 50px;
            cursor: pointer;
        }

        .btn-share:active {
            background: linear-gradient(145deg, #2a2a2a, #1a1a1a);
        }

        .x-icon {
            flex-shrink: 0;
            width: 18px;
            height: 18px;
        }

        .results-buttons {
            display: flex;
            flex-direction: column;
            gap: 8px;
            width: 100%;
        }

        .results-buttons .btn-primary {
            width: 100%;
            padding: 12px 30px;
            font-size: 0.9rem;
        }

        .results-buttons .btn-secondary {
            width: 100%;
            padding: 10px 25px;
        }

        .download-link {
            color: var(--lime);
            text-decoration: none;
            font-weight: 700;
        }

        /* Hidden canvas for image generation */
        #shareCanvas {
            display: none;
        }

        /* Hide number input arrows */
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input[type="number"] {
            -moz-appearance: textfield;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Landing Screen -->
        <div id="landing-screen" class="screen active">
            <div class="content">
                <h1 class="logo">Matiks</h1>
                <p class="tagline">Challenge Your Mind in 30 Seconds</p>
                <div class="game-preview">
                    <div class="game-icon">üß©</div>
                    <div class="game-icon">üß†</div>
                    <div class="game-icon">üî¢</div>
                </div>
                <button class="btn-primary" onclick="startChallenge()">Start Challenge</button>
                <p class="info-text">3 games ‚Ä¢ 10 seconds each ‚Ä¢ Get your IQ score</p>
            </div>
        </div>

        <!-- Pattern Match Game -->
        <div id="pattern-screen" class="screen game-screen">
            <div class="game-header">
                <div class="game-title">Pattern Match</div>
                <div class="timer" id="pattern-timer">10</div>
                <div class="score">Solved: <span id="pattern-score">0</span></div>
            </div>
            <div class="game-container">
                <div class="pattern-sequence">
                    <div class="pattern-item" id="pattern-1"></div>
                    <div class="pattern-item" id="pattern-2"></div>
                    <div class="pattern-item" id="pattern-3"></div>
                    <div class="pattern-item pattern-answer" id="pattern-answer">?</div>
                </div>
                <p class="pattern-instruction">What comes next?</p>
                <div id="pattern-options" class="pattern-options"></div>
            </div>
        </div>

        <!-- Mind Snap Game -->
        <div id="mindsnap-screen" class="screen game-screen">
            <div class="game-header">
                <div class="game-title">Mind Snap</div>
                <div class="timer" id="mindsnap-timer">10</div>
                <div class="score">Solved: <span id="mindsnap-score">0</span></div>
            </div>
            <div class="game-container">
                <div id="mindsnap-grid" class="mindsnap-grid"></div>
                <div id="mindsnap-message" class="game-message"></div>
            </div>
        </div>

        <!-- Math Game -->
        <div id="math-screen" class="screen game-screen">
            <div class="game-header">
                <div class="game-title">Quick Math</div>
                <div class="timer" id="math-timer">10</div>
                <div class="score">Solved: <span id="math-score">0</span></div>
            </div>
            <div class="game-container">
                <div class="math-problem">
                    <div id="math-question" class="math-question"></div>
                    <input type="number" id="math-input" class="math-input" placeholder="?">
                    <div class="numpad">
                        <button class="numpad-btn" onclick="addNumber(1)">1</button>
                        <button class="numpad-btn" onclick="addNumber(2)">2</button>
                        <button class="numpad-btn" onclick="addNumber(3)">3</button>
                        <button class="numpad-btn" onclick="addNumber(4)">4</button>
                        <button class="numpad-btn" onclick="addNumber(5)">5</button>
                        <button class="numpad-btn" onclick="addNumber(6)">6</button>
                        <button class="numpad-btn" onclick="addNumber(7)">7</button>
                        <button class="numpad-btn" onclick="addNumber(8)">8</button>
                        <button class="numpad-btn" onclick="addNumber(9)">9</button>
                        <button class="numpad-btn" onclick="addNumber(0)">0</button>
                        <button class="numpad-btn" onclick="clearInput()">‚å´</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="results-screen" class="screen results-screen">
            <div class="content">
                <div class="ranking-badge" id="ranking-badge">üèÜ Top 0.1% of Players</div>
                <div class="iq-score" id="final-iq">0</div>
                <div class="iq-label">Matiks IQ Score</div>
                
                <div class="genius-comparison" id="genius-comparison">
                    üß† Your IQ matches <span class="genius-names" id="genius-names">Einstein, Hawking & Tesla</span>
                </div>

                <div class="share-card" id="share-card">
                    <div class="share-card-header">
                        <span class="share-card-logo">Matiks</span>
                        <span class="share-card-badge" id="card-badge">Top 0.1%</span>
                    </div>
                    <div class="share-card-scores">
                        <div class="share-card-score-item">
                            <div class="share-card-score-value" id="card-pattern">0</div>
                            <div class="share-card-score-label">Pattern</div>
                        </div>
                        <div class="share-card-score-item">
                            <div class="share-card-score-value" id="card-mindsnap">0</div>
                            <div class="share-card-score-label">Memory</div>
                        </div>
                        <div class="share-card-score-item">
                            <div class="share-card-score-value" id="card-math">0</div>
                            <div class="share-card-score-label">Math</div>
                        </div>
                    </div>
                    <div class="share-card-iq">
                        <div class="share-card-iq-value" id="card-iq">0</div>
                        <div class="share-card-iq-label">IQ Score</div>
                    </div>
                </div>

                <div class="cta-message">
                    üöÄ <strong>Level up your brain!</strong> Download Matiks and train daily with 100+ puzzles. <a href="https://www.matiks.in/" class="download-link" target="_blank">Get it now ‚Üí</a>
                </div>

                <div class="results-buttons">
                    <button class="btn-share" onclick="shareToX()">
                        <svg class="x-icon" viewBox="0 0 24 24">
                            <path fill="currentColor" d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                        </svg>
                        Share on X
                    </button>
                    <button class="btn-secondary" onclick="resetChallenge()">Try Again</button>
                </div>
            </div>
        </div>
    </div>

    <canvas id="shareCanvas" width="600" height="600"></canvas>

    <script>
        // Game State
        let gameState = {
            currentGame: 0,
            scores: { pattern: 0, mindsnap: 0, math: 0 },
            timers: {},
            startTime: 0,
            totalTime: 0,
            gameStartTimes: {},
            finalIQ: 0,
            ranking: '',
            genius: ''
        };

        // Genius comparisons based on IQ ranges
        const geniusData = {
            180: { name: 'Albert Einstein', percentile: '0.001%' },
            170: { name: 'Stephen Hawking', percentile: '0.01%' },
            160: { name: 'Nikola Tesla', percentile: '0.1%' },
            150: { name: 'Elon Musk', percentile: '0.5%' },
            140: { name: 'Steve Jobs', percentile: '1%' },
            130: { name: 'Bill Gates', percentile: '2%' },
            120: { name: 'Mark Zuckerberg', percentile: '5%' },
            110: { name: 'Top Achievers', percentile: '10%' }
        };

        function getGeniusComparison(iq) {
            if (iq >= 175) return geniusData[180];
            if (iq >= 165) return geniusData[170];
            if (iq >= 155) return geniusData[160];
            if (iq >= 145) return geniusData[150];
            if (iq >= 135) return geniusData[140];
            if (iq >= 125) return geniusData[130];
            if (iq >= 115) return geniusData[120];
            return geniusData[110];
        }

        // Utility Functions
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        function startTimer(gameId, duration, callback) {
            let timeLeft = duration;
            const timerElement = document.getElementById(`${gameId}-timer`);
            timerElement.textContent = timeLeft;
            timerElement.classList.remove('warning');
            
            gameState.gameStartTimes[gameId] = Date.now();
            
            gameState.timers[gameId] = setInterval(() => {
                timeLeft--;
                timerElement.textContent = timeLeft;
                
                if (timeLeft <= 3) {
                    timerElement.classList.add('warning');
                }
                
                if (timeLeft <= 0) {
                    clearInterval(gameState.timers[gameId]);
                    timerElement.classList.remove('warning');
                    callback();
                }
            }, 1000);
        }

        function startChallenge() {
            gameState.scores = { pattern: 0, mindsnap: 0, math: 0 };
            gameState.startTime = Date.now();
            gameState.totalTime = 0;
            startPatternGame();
        }

        function resetChallenge() {
            Object.keys(gameState.timers).forEach(key => {
                clearInterval(gameState.timers[key]);
            });
            
            gameState = {
                currentGame: 0,
                scores: { pattern: 0, mindsnap: 0, math: 0 },
                timers: {},
                startTime: 0,
                totalTime: 0,
                gameStartTimes: {},
                finalIQ: 0,
                ranking: '',
                genius: ''
            };
            showScreen('landing-screen');
        }

        // ===== PATTERN MATCH GAME =====
        let patternState = { currentPattern: [], correctAnswer: null, options: [] };

        const patternTypes = [
            {
                generate: () => {
                    const start = Math.floor(Math.random() * 10) + 1;
                    const step = Math.floor(Math.random() * 5) + 2;
                    return { sequence: [start, start + step, start + step * 2], answer: start + step * 3, type: 'number' };
                }
            },
            {
                generate: () => {
                    const start = Math.floor(Math.random() * 3) + 2;
                    const mult = Math.floor(Math.random() * 2) + 2;
                    return { sequence: [start, start * mult, start * mult * mult], answer: start * mult * mult * mult, type: 'number' };
                }
            },
            {
                generate: () => {
                    const shapes = ['‚óè', '‚ñ†', '‚ñ≤', '‚óÜ', '‚òÖ', '‚ô¶Ô∏è', '‚ô†Ô∏è', '‚ô£Ô∏è', '‚ô•Ô∏è'];
                    const shuffled = shapes.sort(() => Math.random() - 0.5);
                    return { sequence: [shuffled[0], shuffled[1], shuffled[2]], answer: shuffled[3], type: 'shape', allShapes: shuffled.slice(0, 6) };
                }
            },
            {
                generate: () => {
                    const a = Math.floor(Math.random() * 5) + 1;
                    const b = Math.floor(Math.random() * 5) + 6;
                    return { sequence: [a, b, a], answer: b, type: 'number' };
                }
            },
            {
                generate: () => {
                    const start = Math.floor(Math.random() * 20) + 30;
                    const step = Math.floor(Math.random() * 5) + 3;
                    return { sequence: [start, start - step, start - step * 2], answer: start - step * 3, type: 'number' };
                }
            },
            {
                generate: () => {
                    const a = Math.floor(Math.random() * 3) + 1;
                    const b = Math.floor(Math.random() * 3) + 2;
                    return { sequence: [a, b, a + b], answer: b + (a + b), type: 'number' };
                }
            }
        ];

        function generatePattern() {
            const patternType = patternTypes[Math.floor(Math.random() * patternTypes.length)];
            const pattern = patternType.generate();
            
            patternState.currentPattern = pattern.sequence;
            patternState.correctAnswer = pattern.answer;
            
            let options = [pattern.answer];
            
            if (pattern.type === 'number') {
                while (options.length < 4) {
                    const variation = Math.floor(Math.random() * 10) - 5;
                    const wrong = pattern.answer + variation;
                    if (wrong !== pattern.answer && wrong > 0 && !options.includes(wrong)) {
                        options.push(wrong);
                    }
                }
            } else if (pattern.type === 'shape') {
                const otherShapes = pattern.allShapes.filter(s => s !== pattern.answer);
                options = [pattern.answer, ...otherShapes.slice(0, 3)];
            }
            
            patternState.options = options.sort(() => Math.random() - 0.5);
        }

        function startPatternGame() {
            showScreen('pattern-screen');
            gameState.scores.pattern = 0;
            document.getElementById('pattern-score').textContent = '0';
            loadNewPattern();
            startTimer('pattern', 10, () => startMindSnapGame());
        }

        function loadNewPattern() {
            generatePattern();
            
            document.getElementById('pattern-1').textContent = patternState.currentPattern[0];
            document.getElementById('pattern-2').textContent = patternState.currentPattern[1];
            document.getElementById('pattern-3').textContent = patternState.currentPattern[2];
            document.getElementById('pattern-answer').textContent = '?';
            document.getElementById('pattern-answer').classList.remove('correct-answer');
            
            const optionsContainer = document.getElementById('pattern-options');
            optionsContainer.innerHTML = '';
            
            patternState.options.forEach(option => {
                const btn = document.createElement('button');
                btn.className = 'pattern-option';
                btn.textContent = option;
                btn.addEventListener('click', () => handlePatternClick(btn, option));
                optionsContainer.appendChild(btn);
            });
        }

        function handlePatternClick(btn, selectedOption) {
            const allBtns = document.querySelectorAll('.pattern-option');
            allBtns.forEach(b => b.style.pointerEvents = 'none');
            
            if (selectedOption === patternState.correctAnswer) {
                btn.classList.add('correct');
                document.getElementById('pattern-answer').textContent = selectedOption;
                document.getElementById('pattern-answer').classList.add('correct-answer');
                gameState.scores.pattern++;
                document.getElementById('pattern-score').textContent = gameState.scores.pattern;
                setTimeout(() => loadNewPattern(), 500);
            } else {
                btn.classList.add('incorrect');
                allBtns.forEach(b => {
                    if (b.textContent == patternState.correctAnswer) b.classList.add('correct');
                });
                setTimeout(() => loadNewPattern(), 700);
            }
        }

        // ===== MIND SNAP GAME =====
        let mindSnapState = { currentPattern: [], clickedCells: [], wrongClicks: 0, maxWrong: 1 };

        function startMindSnapGame() {
            showScreen('mindsnap-screen');
            gameState.scores.mindsnap = 0;
            document.getElementById('mindsnap-score').textContent = '0';
            loadNewMindSnapPattern();
            startTimer('mindsnap', 10, () => startMathGame());
        }

        function loadNewMindSnapPattern() {
            mindSnapState.clickedCells = [];
            mindSnapState.wrongClicks = 0;
            
            const grid = document.getElementById('mindsnap-grid');
            const message = document.getElementById('mindsnap-message');
            grid.innerHTML = '';
            message.textContent = 'Memorize the pattern...';
            
            for (let i = 0; i < 16; i++) {
                const cell = document.createElement('div');
                cell.className = 'mindsnap-cell';
                cell.dataset.index = i;
                grid.appendChild(cell);
            }
            
            const patternSize = 4 + Math.floor(Math.random() * 2);
            mindSnapState.currentPattern = [];
            
            while (mindSnapState.currentPattern.length < patternSize) {
                const index = Math.floor(Math.random() * 16);
                if (!mindSnapState.currentPattern.includes(index)) {
                    mindSnapState.currentPattern.push(index);
                }
            }
            
            mindSnapState.currentPattern.forEach(index => {
                grid.children[index].classList.add('shown');
            });
            
            setTimeout(() => {
                document.querySelectorAll('.mindsnap-cell').forEach(cell => {
                    cell.classList.remove('shown');
                    cell.addEventListener('click', handleMindSnapClick);
                });
                message.textContent = 'Click the colored tiles!';
            }, 1000);
        }

        function handleMindSnapClick(e) {
            const cell = e.currentTarget;
            const index = parseInt(cell.dataset.index);
            
            if (mindSnapState.clickedCells.includes(index)) return;
            mindSnapState.clickedCells.push(index);
            
            if (mindSnapState.currentPattern.includes(index)) {
                cell.classList.add('correct');
                const correctClicks = mindSnapState.clickedCells.filter(i => mindSnapState.currentPattern.includes(i)).length;
                
                if (correctClicks === mindSnapState.currentPattern.length) {
                    gameState.scores.mindsnap++;
                    document.getElementById('mindsnap-score').textContent = gameState.scores.mindsnap;
                    document.getElementById('mindsnap-message').textContent = 'Perfect!';
                    setTimeout(() => loadNewMindSnapPattern(), 500);
                }
            } else {
                cell.classList.add('incorrect');
                mindSnapState.wrongClicks++;
                if (mindSnapState.wrongClicks > mindSnapState.maxWrong) {
                    document.getElementById('mindsnap-message').textContent = 'Oops! Next one...';
                    setTimeout(() => loadNewMindSnapPattern(), 700);
                }
            }
        }

        // ===== MATH GAME =====
        let mathState = { currentAnswer: 0 };

        function startMathGame() {
            showScreen('math-screen');
            gameState.scores.math = 0;
            document.getElementById('math-score').textContent = '0';
            document.getElementById('math-input').value = '';
            
            loadNewMathProblem();
            
            const input = document.getElementById('math-input');
            const newInput = input.cloneNode(true);
            input.parentNode.replaceChild(newInput, input);
            
            newInput.addEventListener('input', () => checkMathAnswer());
            startTimer('math', 10, () => showResults());
        }

        function loadNewMathProblem() {
            const operations = ['+', '-', '√ó'];
            const operation = operations[Math.floor(Math.random() * operations.length)];
            let num1, num2, answer;
            
            switch(operation) {
                case '+':
                    num1 = Math.floor(Math.random() * 30) + 5;
                    num2 = Math.floor(Math.random() * 30) + 5;
                    answer = num1 + num2;
                    break;
                case '-':
                    num1 = Math.floor(Math.random() * 30) + 20;
                    num2 = Math.floor(Math.random() * (num1 - 5)) + 1;
                    answer = num1 - num2;
                    break;
                case '√ó':
                    num1 = Math.floor(Math.random() * 10) + 2;
                    num2 = Math.floor(Math.random() * 10) + 2;
                    answer = num1 * num2;
                    break;
            }
            
            mathState.currentAnswer = answer;
            document.getElementById('math-question').textContent = `${num1} ${operation} ${num2}`;
            document.getElementById('math-input').value = '';
            document.getElementById('math-input').classList.remove('correct', 'incorrect');
        }

        function addNumber(num) {
            const input = document.getElementById('math-input');
            input.value += num;
            checkMathAnswer();
        }

        function clearInput() {
            const input = document.getElementById('math-input');
            input.value = '';
            input.classList.remove('correct', 'incorrect');
        }

        function checkMathAnswer() {
            const input = document.getElementById('math-input');
            const userAnswer = parseInt(input.value);
            
            if (isNaN(userAnswer)) return;
            
            if (userAnswer === mathState.currentAnswer) {
                input.classList.add('correct');
                input.classList.remove('incorrect');
                gameState.scores.math++;
                document.getElementById('math-score').textContent = gameState.scores.math;
                setTimeout(() => loadNewMathProblem(), 200);
            } else if (input.value.length >= mathState.currentAnswer.toString().length) {
                input.classList.add('incorrect');
                input.classList.remove('correct');
            }
        }

        // ===== RESULTS =====
        function calculateIQ() {
            const totalScore = gameState.scores.pattern + gameState.scores.mindsnap + gameState.scores.math;
            if (totalScore === 0) return 0;
            
            gameState.totalTime = (Date.now() - gameState.startTime) / 1000;
            
            // Boosted IQ calculation (+10 across the board)
            const scoreComponent = Math.min(totalScore * 5, 50); // Increased multiplier
            const maxTime = 30;
            const timeBonus = Math.max(0, (maxTime - gameState.totalTime) * 0.8);
            
            // Base IQ now starts at 110 instead of 100
            let iq = 110 + scoreComponent + timeBonus;
            
            // Clamp to 115-180 range (boosted range)
            return Math.max(115, Math.min(180, Math.round(iq)));
        }

        function showResults() {
            Object.keys(gameState.timers).forEach(key => clearInterval(gameState.timers[key]));
            if (gameState.totalTime === 0) gameState.totalTime = (Date.now() - gameState.startTime) / 1000;
            
            showScreen('results-screen');
            
            const totalScore = gameState.scores.pattern + gameState.scores.mindsnap + gameState.scores.math;
            let iq = totalScore === 0 ? 0 : calculateIQ();
            gameState.finalIQ = iq;
            
            // Get genius comparison
            const comparison = iq > 0 ? getGeniusComparison(iq) : { name: '', percentile: '‚Äî' };
            gameState.ranking = comparison.percentile;
            gameState.genius = comparison.name;
            
            // Update UI
            const iqElement = document.getElementById('final-iq');
            const rankingBadge = document.getElementById('ranking-badge');
            const geniusComparison = document.getElementById('genius-comparison');
            const geniusNames = document.getElementById('genius-names');
            
            if (iq === 0) {
                iqElement.textContent = '0';
                rankingBadge.textContent = 'üéØ Time to Train!';
                geniusComparison.innerHTML = 'üöÄ Start your brain training journey with <a href="https://matiks-iq.vercel.app" class="download-link" target="_blank">Matiks</a>!';
            } else {
                // Animate IQ
                let currentIQ = 0;
                const increment = iq / 40;
                const iqInterval = setInterval(() => {
                    currentIQ += increment;
                    if (currentIQ >= iq) {
                        currentIQ = iq;
                        clearInterval(iqInterval);
                    }
                    iqElement.textContent = Math.round(currentIQ);
                }, 30);
                
                rankingBadge.textContent = `üèÜ Top ${comparison.percentile} of Players`;
                geniusNames.textContent = comparison.name;
            }
            
            // Update share card
            document.getElementById('card-pattern').textContent = gameState.scores.pattern;
            document.getElementById('card-mindsnap').textContent = gameState.scores.mindsnap;
            document.getElementById('card-math').textContent = gameState.scores.math;
            document.getElementById('card-iq').textContent = iq;
            document.getElementById('card-badge').textContent = iq > 0 ? `Top ${comparison.percentile}` : 'Beginner';
        }

        // Generate share card image
        function generateShareImage() {
            const canvas = document.getElementById('shareCanvas');
            const ctx = canvas.getContext('2d');
            
            // Background gradient
            const gradient = ctx.createLinearGradient(0, 0, 600, 600);
            gradient.addColorStop(0, '#0f0f1a');
            gradient.addColorStop(1, '#1a1a2e');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 600, 600);
            
            // Border
            ctx.strokeStyle = 'rgba(255,255,255,0.1)';
            ctx.lineWidth = 2;
            ctx.strokeRect(20, 20, 560, 560);
            
            // Logo
            ctx.font = 'bold 48px Segoe UI';
            const logoGradient = ctx.createLinearGradient(200, 60, 400, 60);
            logoGradient.addColorStop(0, '#B1FA63');
            logoGradient.addColorStop(1, '#B3A1FF');
            ctx.fillStyle = logoGradient;
            ctx.textAlign = 'center';
            ctx.fillText('Matiks', 300, 80);
            
            // Ranking badge
            ctx.fillStyle = '#FFD700';
            ctx.font = 'bold 20px Segoe UI';
            ctx.fillText(`üèÜ Top ${gameState.ranking} of Players`, 300, 130);
            
            // IQ Score
            ctx.font = 'bold 120px Segoe UI';
            const iqGradient = ctx.createLinearGradient(150, 200, 450, 320);
            iqGradient.addColorStop(0, '#B1FA63');
            iqGradient.addColorStop(1, '#B3A1FF');
            ctx.fillStyle = iqGradient;
            ctx.fillText(gameState.finalIQ.toString(), 300, 280);
            
            // IQ Label
            ctx.fillStyle = 'rgba(255,255,255,0.5)';
            ctx.font = '18px Segoe UI';
            ctx.fillText('MATIKS IQ SCORE', 300, 320);
            
            // Genius comparison
            ctx.fillStyle = '#B1FA63';
            ctx.font = 'bold 22px Segoe UI';
            ctx.fillText(`Similar to: ${gameState.genius}`, 300, 380);
            
            // Score boxes
            const scores = [
                { label: 'Pattern', value: gameState.scores.pattern },
                { label: 'Memory', value: gameState.scores.mindsnap },
                { label: 'Math', value: gameState.scores.math }
            ];
            
            ctx.fillStyle = 'rgba(255,255,255,0.05)';
            ctx.fillRect(50, 420, 160, 80);
            ctx.fillRect(220, 420, 160, 80);
            ctx.fillRect(390, 420, 160, 80);
            
            scores.forEach((score, i) => {
                const x = 130 + (i * 170);
                ctx.fillStyle = '#B1FA63';
                ctx.font = 'bold 36px Segoe UI';
                ctx.fillText(score.value.toString(), x, 465);
                ctx.fillStyle = 'rgba(255,255,255,0.5)';
                ctx.font = '14px Segoe UI';
                ctx.fillText(score.label, x, 490);
            });
            
            // CTA
            ctx.fillStyle = 'rgba(255,255,255,0.7)';
            ctx.font = '18px Segoe UI';
            ctx.fillText('Can you beat my score? Take the challenge! üëá', 300, 560);
            
            return canvas.toDataURL('image/png');
        }

        function shareToX() {
            const iq = gameState.finalIQ || 0;
            const ranking = gameState.ranking || '‚Äî';
            const genius = gameState.genius || '';
            
            let text;
            if (iq === 0) {
                text = `I just took the Matiks IQ Challenge! üß†\n\nTime to train my brain! üí™\n\nThink you can beat me? Take the 30-second challenge:`;
            } else {
                text = `üèÜ I'm in the Top ${ranking} of players!\n\nüß† My Matiks IQ: ${iq}\n‚ú® Similar to: ${genius}\n\nThink you're smarter? Prove it! Take the 30-second challenge:`;
            }
            
            const url = 'https://matiks-iq.vercel.app/';
            window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`, '_blank');
        }
    </script>
</body>
</html>